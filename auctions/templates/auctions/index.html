{% extends "auctions/layout.html" %}
{% load my_filters %}

{% block title %}
    Pet Costumes Auction
{% endblock %}

{% block body %}

<div class="container main-content">
    {% if user.is_authenticated %}
    <div class="row pt-1 bg-brown">
        <div class="col">
        <ul class="nav nav-pills mb-1 sub-nav" id="pills-tab" role="tablist">
            <li class="nav-item pill-section" role="presentation">
                <a class="nav-link disabled" id="pills-bids-tab" data-bs-toggle="pill" href="" role="tab" aria-controls="pills-bids" aria-selected="false">{{ user | capfirst }}'s Dashboard:</a>
            </li>
            <li class="nav-item pill-sub" role="presentation">
                <a class="nav-link active" id="pills-bids-tab" data-bs-toggle="pill" href="#pills-bids" role="tab" aria-controls="pills-bids" aria-selected="false">Bids</a>
            </li>
            <li class="nav-item pill-sub" role="presentation">
                <a class="nav-link" id="pills-owned-tab" data-bs-toggle="pill" href="#pills-owned" role="tab" aria-controls="pills-owned" aria-selected="false">Listings</a>
            </li>
            <li class="nav-item pill-sub" role="presentation">
                <a class="nav-link" id="pills-watching-tab" data-bs-toggle="pill" href="#pills-watching" role="tab" aria-controls="pills-watching" aria-selected="true">Watchlist</a>
            </li>    
            <li class="nav-item pill-sub" role="presentation">
                <a class="nav-link" id="pills-winnings-tab" data-bs-toggle="pill" href="#pills-winnings" role="tab" aria-controls="pills-winnings" aria-selected="false">Winnings</a>
            </li>
        </ul>
        </div>
    </div>
    <div class="row">
        <div class="col p-4">
        <div class="tab-content" id="pills-tabContent">

            <div class="tab-pane show active" id="pills-bids" role="tabpanel" aria-labelledby="pills-bids-tab">
                
                <h2>Outbid</h2>

                <ul>
                    {% for listing in outbid %}
                    <li>
                        <a href="{% url 'listing' listing.item.id %}">
                        {{ listing.item.title }} 
                        </a>
                        -  Your Last Bid: {{ listing.amount | currency }} | Current Bid: {{ listing.item.current_price | currency }}
                    </li>
                    {% empty %}
                    <em>No one is currently outbidding you!</em>
                    {% endfor %}
                </ul>

                <h2>Highest Bidder</h2>

                <ul>
                    {% for listing in high %}
                    <li>
                        <a href="{% url 'listing' listing.item.id %}">
                        {{ listing.item.title }}
                        </a>
                        -  Your Last Bid: {{ listing.amount | currency }}
                    </li>
                    {% empty %}
                    <em>You are not the highest bidder in any auctions!</em>
                    {% endfor %}
                </ul>

                <h2>Lost Auctions</h2>

                <ul>
                    {% for listing in lost %}
                    <li>
                        <a href="{% url 'listing' listing.item.id %}">
                        {{ listing.item.title }}
                        </a> -  Winner: {{ listing.item.winner }}
                    </li>
                    {% empty %}
                    <em>You have not lost any auctions!</em>
                    {% endfor %}
                </ul>

            </div>
            <div class="tab-pane show" id="pills-owned" role="tabpanel" aria-labelledby="pills-owned-tab">

                <h2>My Listings</h2>

                <ul>
                    {% for listing in owned %}
                    <li>
                        <a href="{% url 'listing' listing.id %}">
                        {{ listing.title }}
                        </a>
                        {% if listing.current_price == listing.reserve %}
                            <em>Reserve not met!</em>
                        {% else %}
                            - Current Bid: {{ listing.current_price | currency }}
                        {% endif %}
                    </li>
                    {% empty %}
                    <em>You have not created any auctions!</em>
                    {% endfor %}
                </ul>

            </div>
            <div class="tab-pane show" id="pills-watching" role="tabpanel" aria-labelledby="pills-watching-tab">

                <h2>My Watchlist</h2>
                <ul>
                    {% for listing in watchlist %}
                    <li>
                        <a href="{% url 'listing' listing.item.id %}">
                        {{ listing.item }}
                        </a>
                        - Current Bid: {{ listing.item.current_price| currency  }}
                    </li>
                    {% empty %}
                    <em>No listings on watchlist!</em>
                    {% endfor %}
                </ul>

            </div>
            <div class="tab-pane show" id="pills-winnings" role="tabpanel" aria-labelledby="pills-winnings-tab">

                <h2>My Winnings</h2>
                <ul>
                    {% for listing in winnings %}
                    <li>
                        <a href="{% url 'listing' listing.id %}">
                        {{ listing.title }}
                        </a>
                    </li>
                    {% empty %}
                    <em>You haven't won any auctions!</em>
                    {% endfor %}
                </ul>

            </div>
            
        </div>
        </div>
    </div>
    {% else %}
    <div class="row">
        <div class="col p-4">
        <h2>Active Listings</h2>

            <ul>
                {% for listing in listings %}
                <li>
                    <a href="{% url 'listing' listing.id %}">
                    {{ listing.title }}
                    </a>
                    - Current Price: {{ listing.current_price | currency }}
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}